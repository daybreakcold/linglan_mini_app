<view class="page">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯¾ç¨‹å†…å®¹ -->
  <scroll-view scroll-y class="content" wx:elif="{{course}}">
    <!-- è§†é¢‘æ’­æ”¾åŒºåŸŸ -->
    <view class="video-cover-wrapper">
      <!-- è§†é¢‘æ’­æ”¾å™¨ -->
      <video
        wx:if="{{showVideo && currentVideo}}"
        class="video-player"
        src="{{currentVideo.videoUrl}}"
        poster="{{currentVideo.coverUrl || course.coverUrl}}"
        title="{{currentVideo.title}}"
        autoplay="{{true}}"
        show-fullscreen-btn="{{true}}"
        show-play-btn="{{true}}"
        controls="{{true}}"
        bindended="onVideoEnded"
        binderror="onVideoError"
      ></video>
      <!-- å°é¢å›¾ -->
      <block wx:else>
        <image
          class="video-cover"
          src="{{course.coverUrl || '/images/course-default.png'}}"
          mode="aspectFill"
        ></image>
        <view class="play-btn" bindtap="onPlayVideo">
          <view class="play-icon">
            <text class="play-triangle">â–¶</text>
          </view>
        </view>
      </block>
    </view>

    <!-- è¯¾ç¨‹ä¿¡æ¯åŒºåŸŸ -->
    <view class="course-info-section">
      <!-- æ ‡ç­¾å’Œç»Ÿè®¡ -->
      <view class="course-meta-row">
        <view class="member-tag">ä¼šå‘˜å…è´¹</view>
        <view class="stats-row">
          <image class="stats-icon" src="/images/icons/view.svg" mode="aspectFit"></image>
          <text class="stats-text">{{course.viewCount || 0}}</text>
          <image class="stats-icon star-icon" src="/images/icons/star.svg" mode="aspectFit"></image>
          <text class="stats-text">{{course.rating || '4.5'}}</text>
        </view>
      </view>

      <!-- è¯¾ç¨‹æ ‡é¢˜ -->
      <text class="course-title">{{course.title}}</text>

      <!-- è¯¾ç¨‹æè¿° -->
      <view class="course-desc">
        <text class="desc-text">{{course.intro}}</text>
      </view>
      <view class="course-desc" wx:if="{{course.description}}">
        <text class="desc-text secondary">{{course.description}}</text>
      </view>
    </view>

    <!-- æœ¬è¯¾ç¨‹åŒ…å« -->
    <view class="course-includes-section">
      <text class="section-title">æœ¬è¯¾ç¨‹åŒ…å«</text>
      <view class="includes-list">
        <!-- è§†é¢‘è¯¾ç¨‹ï¼ˆæœ‰è§†é¢‘æ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="include-item" wx:if="{{course.videoCount > 0}}">
          <view class="include-icon-wrapper video-icon-bg">
            <image class="include-icon" src="/images/icons/video-camera.svg" mode="aspectFit"></image>
          </view>
          <text class="include-text">{{course.totalDurationText}}å°æ—¶è§†é¢‘è¯¾ç¨‹å†…å®¹</text>
        </view>
        <!-- å›¾æ–‡å†…å®¹ï¼ˆæœ‰æ–‡ç« æ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="include-item" wx:if="{{course.articleCount > 0}}">
          <view class="include-icon-wrapper article-icon-bg">
            <image class="include-icon" src="/images/icons/document.svg" mode="aspectFit"></image>
          </view>
          <text class="include-text">{{course.articleCount}}ç¯‡å›¾æ–‡å†…å®¹</text>
        </view>
        <!-- è¯¾ç¨‹èŠ‚æ•° -->
        <view class="include-item">
          <view class="include-icon-wrapper offline-icon-bg">
            <image class="include-icon" src="/images/icons/list.svg" mode="aspectFit"></image>
          </view>
          <text class="include-text">å…±{{course.sectionCount}}èŠ‚è¯¾</text>
        </view>
      </view>
    </view>

    <!-- è¯¾ç¨‹è¯¦æƒ… -->
    <view class="course-detail-section">
      <text class="section-title">è¯¾ç¨‹è¯¦æƒ…</text>
      <view class="section-list">
        <view
          class="section-item {{item.available ? '' : 'disabled'}}"
          wx:for="{{course.sections}}"
          wx:key="id"
          data-index="{{index}}"
          data-section="{{item}}"
          bindtap="onSectionTap"
        >
          <view class="section-content">
            <view class="section-header">
              <text class="section-seq">ç¬¬{{item.seq < 10 ? '0' + item.seq : item.seq}}è¯¾</text>
              <text class="section-name">{{item.title}}</text>
            </view>
            <view class="section-meta">
              <text class="section-type" wx:if="{{item.isArticle}}">[å›¾æ–‡]</text>
              <text class="section-type" wx:elif="{{item.isVideo}}">[è§†é¢‘]</text>
              <text class="section-duration" wx:if="{{item.durationText}}">{{item.durationText}}</text>
              <text class="section-instructor" wx:if="{{item.instructor}}">ä¸»è®²: {{item.instructor}}</text>
              <text class="section-instructor" wx:elif="{{item.isVideo}}">ä¸»è®²: {{course.instructorName || 'ç‹æ–‡æ¸…è€å¸ˆ'}}</text>
            </view>
            <text class="section-status" wx:if="{{!item.available}}">è¯¾ç¨‹æŒç»­å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…</text>
          </view>
          <view class="section-play-btn {{item.available ? 'active' : ''}}">
            <text class="section-play-icon" wx:if="{{item.isVideo}}">â–¶</text>
            <text class="section-play-icon" wx:else>ğŸ“„</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-area-bottom"></view>
  </scroll-view>

  <!-- æ— æ•°æ® -->
  <view class="empty-container" wx:else>
    <text class="empty-text">è¯¾ç¨‹ä¸å­˜åœ¨</text>
  </view>
</view>
