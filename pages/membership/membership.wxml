<view class="page">
  <!-- 状态栏占位 -->
  <view class="status-bar"></view>
  
  <!-- 顶部导航栏 -->
  <view class="navbar">
    <view class="navbar-left" bindtap="onBack">
      <image class="back-icon" src="/images/icons/arrow-left.svg" />
    </view>
    <text class="navbar-title">我的权益</text>
    <view class="navbar-right"></view>
  </view>

  <!-- 深色背景区域 -->
  <view class="dark-header">
    <!-- 用户信息 -->
    <view class="user-section">
      <view class="user-info">
        <view class="avatar-wrapper">
          <image class="avatar" src="{{userInfo.avatar || '/images/icons/avatar-user.svg'}}" />
          <view class="avatar-badge">
            <image class="crown-icon" src="/images/icons/crown.svg" mode="aspectFit" />
          </view>
        </view>
        <view class="user-details">
          <view class="user-name-row">
            <text class="user-name">{{userInfo.nickname || '会员昵称'}}</text>
            <view class="vip-badge" wx:if="{{membership.active}}">
              <text class="vip-text">SVIP{{membership.level || 1}}</text>
            </view>
          </view>
          <text class="expire-text" wx:if="{{membership.active}}">包月会员于 {{membership.expireDate || '---'}} 到期</text>
          <text class="expire-text" wx:else>暂未开通会员</text>
        </view>
      </view>
    </view>

    <!-- 积分进度条 -->
    <view class="progress-section" wx:if="{{membership.active}}">
      <view class="level-badge">
        <text class="level-text">V{{membership.level || 1}}</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{membership.progressPercent || 0}}%;"></view>
      </view>
      <view class="level-badge">
        <text class="level-text">V{{(membership.level || 1) + 1}}</text>
      </view>
      <text class="progress-text">当前积分 {{membership.growthValue || 0}}/{{membership.nextLevelValue || 1000}}</text>
    </view>

    <!-- 卡号和续费 -->
    <view class="card-info-row" wx:if="{{membership.active}}">
      <text class="card-no">NO.{{membership.cardNo || '---- ---- ---- ----'}}</text>
      <view class="renew-btn" bindtap="onRenew">
        <text class="renew-text">立即续费</text>
      </view>
    </view>
  </view>

  <!-- 套餐选择区域 -->
  <view class="plans-section">
    <view class="plans-container">
      <!-- 连续包月 -->
      <view 
        class="plan-card {{selectedPlan === 'monthly' ? 'plan-selected' : ''}}" 
        bindtap="onSelectPlan" 
        data-plan="monthly"
      >
        <view class="plan-tag tag-discount">
          <text class="tag-text">限时优惠</text>
        </view>
        <text class="plan-name">连续包月</text>
        <view class="plan-price">
          <text class="price-symbol">¥</text>
          <text class="price-amount">{{plans.monthly.price}}</text>
        </view>
        <text class="price-original">¥{{plans.monthly.originalPrice}}</text>
        <view class="plan-desc">
          <text>次月¥{{plans.monthly.renewPrice}} 续费</text>
          <text>可随时取消</text>
        </view>
      </view>

      <!-- 连续包年 -->
      <view 
        class="plan-card {{selectedPlan === 'yearly' ? 'plan-selected' : ''}}" 
        bindtap="onSelectPlan" 
        data-plan="yearly"
      >
        <view class="plan-tag tag-recommend">
          <text class="tag-text">超值推荐</text>
        </view>
        <text class="plan-name">连续包年</text>
        <view class="plan-price">
          <text class="price-symbol">¥</text>
          <text class="price-amount">{{plans.yearly.price}}</text>
        </view>
        <text class="price-original">¥{{plans.yearly.originalPrice}}</text>
        <view class="plan-desc">
          <text>次年¥{{plans.yearly.renewPrice}} 续费</text>
          <text>可随时取消</text>
        </view>
      </view>

      <!-- 连续包季 -->
      <view 
        class="plan-card {{selectedPlan === 'quarterly' ? 'plan-selected' : ''}}" 
        bindtap="onSelectPlan" 
        data-plan="quarterly"
      >
        <view class="plan-tag tag-discount">
          <text class="tag-text">限时优惠</text>
        </view>
        <text class="plan-name">连续包季</text>
        <view class="plan-price">
          <text class="price-symbol">¥</text>
          <text class="price-amount">{{plans.quarterly.price}}</text>
        </view>
        <text class="price-original">¥{{plans.quarterly.originalPrice}}</text>
        <view class="plan-desc">
          <text>次季¥{{plans.quarterly.renewPrice}} 续费</text>
          <text>可随时取消</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 立即开通按钮 -->
  <view class="subscribe-section">
    <view class="subscribe-btn" bindtap="onSubscribe">
      <text class="subscribe-text">立即开通</text>
    </view>
  </view>

  <!-- 会员协议 -->
  <view class="agreement-section">
    <text class="agreement-text">
      在您注册成为会员之前，请认真阅读本《会员服务协议》（以下简称"服务协议"），确保您充分理解服务协议中各条款，包括免除微鲤责任的条款及限制会员权利的条款。请您审慎阅读并选择接受或不接受本服务协议。除非您接受本服务协议所有条款，否则您不得注册、登录或使用本服务协议所涉服务。您的注册、登录、使用等行将视为对本服务协议的接受，并同意接受本服务协议各项条款的约束。本服务协议可由灵医随时更新，更新后的服务协议一旦公布即代替原来的服务协议，恕不再另行通知，用户可在应用内查阅最新版服务协议
    </text>
  </view>
</view>
