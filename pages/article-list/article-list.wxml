<!--pages/article-list/article-list.wxml-->
<view class="flex-col page">
  <!-- 顶部背景装饰 -->
  <view class="shrink-0 header-bg"></view>

  <!-- 主内容区 -->
  <view class="flex-col content">
    <!-- 标题栏 -->
    <view class="flex-row justify-center items-center relative title-bar">
      <image
        class="back-icon pos"
        src="/images/icons/arrow-left.svg"
        bindtap="onBack"
      />
      <text class="title-text">健康科普</text>
      <view class="flex-row pos_2">
        <image
          class="search-icon"
          src="/images/icons/search.svg"
          bindtap="onSearch"
        />
        <image
          class="ml-26 more-icon"
          src="/images/icons/message.svg"
          bindtap="onMore"
        />
      </view>
    </view>

    <!-- 标签筛选栏 -->
    <view class="flex-col tag-section">
      <view class="flex-row justify-between items-center self-stretch tag-bar">
        <text
          wx:for="{{tags}}"
          wx:key="key"
          class="tag-item {{currentTagIndex === index ? 'tag-active' : ''}}"
          data-index="{{index}}"
          bindtap="onTagTap"
        >{{item.name}}</text>
        <image
          class="expand-icon"
          src="/images/icons/arrow-down.svg"
          bindtap="onExpandTags"
        />
      </view>
      <!-- 选中指示器 -->
      <view class="self-start tag-indicator" style="margin-left: {{76 + currentTagIndex * 110}}rpx;"></view>
    </view>

    <!-- 文章列表 -->
    <view class="flex-col article-list">
      <!-- 加载中 -->
      <view wx:if="{{isLoading}}" class="loading-wrap">
        <text>加载中...</text>
      </view>

      <!-- 文章卡片列表 -->
      <block wx:else>
        <view
          wx:for="{{articles}}"
          wx:key="id"
          class="{{index > 0 ? 'mt-26' : ''}} flex-col article-card"
          data-id="{{item.id}}"
          bindtap="onArticleTap"
        >
          <!-- 文章封面 -->
          <image
            class="article-cover"
            src="{{item.coverUrl || '/images/article/default-cover.png'}}"
            mode="aspectFill"
          />
          <!-- 文章信息栏 -->
          <view class="flex-row justify-between items-center article-info">
            <!-- 左侧：作者头像和标题 -->
            <view class="flex-row items-center flex-1">
              <image
                class="author-avatar"
                src="{{item.authorAvatar || '/images/icons/avatar-doctor.svg'}}"
                mode="aspectFill"
              />
              <view class="flex-col ml-16 article-meta">
                <text class="article-title">{{item.title}}</text>
                <text class="article-summary">{{item.summary}}</text>
              </view>
            </view>
            <!-- 右侧：互动按钮 -->
            <view class="flex-row items-center">
              <view class="flex-row items-center action-btn" data-id="{{item.id}}" data-index="{{index}}" catchtap="onLikeTap">
                <image class="like-icon" src="/images/icons/like.svg" />
                <text class="count-text ml-4" wx:if="{{item.likeCount}}">{{item.likeCount}}</text>
              </view>
              <view class="flex-row items-center action-btn ml-24" data-id="{{item.id}}" data-index="{{index}}" catchtap="onFavoriteTap">
                <image class="favorite-icon" src="/images/icons/favorite.svg" />
              </view>
            </view>
          </view>
        </view>

        <!-- 加载更多状态 -->
        <view wx:if="{{isLoadingMore}}" class="loading-more">
          <text>加载中...</text>
        </view>
        <view wx:if="{{!hasNext && articles.length > 0}}" class="no-more">
          <text>- 没有更多了 -</text>
        </view>
        <view wx:if="{{!isLoading && articles.length === 0}}" class="empty">
          <text>暂无文章</text>
        </view>
      </block>
    </view>
  </view>

  <!-- 底部安全区域 -->
  <view class="safe-bottom"></view>
</view>
